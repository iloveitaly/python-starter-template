# https://lefthook.dev/configuration/
# Full list of hooks: https://git-scm.com/docs/githooks

prepare-commit-msg:
  commands:
    aiautocommit:
      run: aiautocommit commit --output-file "{1}"
      interactive: true
      env:
        # without this, lefthook will run in an infinite loop
        LEFTHOOK: 0
        # ensures that LOG_LEVEL config of the current project does not interfere with aiautocommit
        LOG_LEVEL: info
      skip:
        merge:
        rebase:
        # only run this if the tool exists
        run: ! which aiautocommit > /dev/null

# Use this to validate commit messages
commit-msg:
  commands:
    commitlint:
      run: commitlint
    skip:
      # only run this if the tool exists, it's conditionally installed
      # https://keisukeyamashita.github.io/commitlint-rs/
      run: ! which commitlint > /dev/null


# {push_files} are just the files that are going to be pushed, not all files unique to this branch that would be pushed if the push was fresh
# this means that if someone just enables lefthook, or if the linter
pre-push:
  parallel: true
  commands:
    py_lint:
      run: just py_lint
    js_lint:
      run: just js_lint

# TODO detect database migrations from rebase
# TODO detect uv.lock changes and rerun setup
# TODO detect pnpm changes and rerun setup
